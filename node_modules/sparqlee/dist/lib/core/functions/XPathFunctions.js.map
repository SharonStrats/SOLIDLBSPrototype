{"version":3,"file":"XPathFunctions.js","sourceRoot":"","sources":["../../../../lib/core/functions/XPathFunctions.ts"],"names":[],"mappings":";;AACA,sDAAsD;AACtD,+CAA+C;AAC/C,SAAgB,OAAO,CAAC,IAAY,EAAE,OAAe,EAAE,KAAc;IACnE,2DAA2D;IAC3D,mDAAmD;IACnD,MAAM,GAAG,GAAG,IAAI,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;IACvC,OAAO,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACxB,CAAC;AALD,0BAKC;AAED,8BAA8B;AAC9B,2BAA2B;AAC3B,uCAAuC;AACvC,yDAAyD;AACzD,SAAgB,WAAW,CAAC,GAAW,EAAE,KAAa;IACpD,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAChC,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAEnC,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;WACxC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;QAAE,OAAO,KAAK,CAAC;KAAE;IAEjD,IAAI,EAAE,GAAG,CAAC,CAAC;IACX,IAAI,EAAE,GAAG,CAAC,CAAC;IACX,OAAO,EAAE,GAAG,SAAS,CAAC,MAAM,EAAE;QAC5B,IAAI,WAAW,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE;YAAE,EAAE,EAAE,CAAC;YAAC,SAAS;SAAE;QACnD,IAAI,EAAE,KAAK,QAAQ,CAAC,MAAM,EAAE;YAAE,OAAO,KAAK,CAAC;SAAE;QAC7C,IAAI,aAAa,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC,EAAE;YAAE,EAAE,EAAE,CAAC;YAAC,EAAE,EAAE,CAAC;YAAC,SAAS;SAAE;QACzE,IAAI,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;YAAE,OAAO,KAAK,CAAC;SAAE;QAChD,EAAE,EAAE,CAAC;KACN;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAjBD,kCAiBC;AAED,SAAS,WAAW,CAAC,GAAW;IAC9B,OAAO,GAAG,KAAK,GAAG,CAAC;AACrB,CAAC;AAED,SAAS,aAAa,CAAC,IAAY,EAAE,KAAa;IAChD,MAAM,YAAY,GAAG,IAAI,MAAM,CAAC,IAAI,IAAI,GAAG,EAAE,GAAG,CAAC,CAAC;IAClD,OAAO,YAAY,CAAC,IAAI,CAAC,IAAI,KAAK,GAAG,CAAC,CAAC;AACzC,CAAC","sourcesContent":["\n// https://www.w3.org/TR/xpath-functions/#func-matches\n// https://www.w3.org/TR/xpath-functions/#flags\nexport function matches(text: string, pattern: string, flags?: string): boolean {\n  // TODO: Only flags 'i' and 'm' match between XPath and JS.\n  // 's', 'x', 'q', would need proper implementation.\n  const reg = new RegExp(pattern, flags);\n  return reg.test(text);\n}\n\n// TODO: Not an XPath function\n// TODO: Publish as package\n// https://www.ietf.org/rfc/rfc4647.txt\n// https://www.w3.org/TR/sparql11-query/#func-langMatches\nexport function langMatches(tag: string, range: string): boolean {\n  const langTags = tag.split('-');\n  const rangeTags = range.split('-');\n\n  if (!_matchLangTag(rangeTags[0], langTags[0])\n    && !_isWildCard(langTags[0])) { return false; }\n\n  let lI = 1;\n  let rI = 1;\n  while (rI < rangeTags.length) {\n    if (_isWildCard(rangeTags[rI])) { rI++; continue; }\n    if (lI === langTags.length) { return false; }\n    if (_matchLangTag(rangeTags[rI], langTags[lI])) { lI++; rI++; continue; }\n    if (langTags[lI].length === 1) { return false; }\n    lI++;\n  }\n  return true;\n}\n\nfunction _isWildCard(tag: string): boolean {\n  return tag === '*';\n}\n\nfunction _matchLangTag(left: string, right: string): boolean {\n  const matchInitial = new RegExp(`/${left}/`, 'i');\n  return matchInitial.test(`/${right}/`);\n}\n"]}